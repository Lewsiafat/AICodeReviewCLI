# AI 程式碼審查 CLI

這是一個強大的命令列介面 (CLI) 工具，旨在利用人工智慧自動化並增強您的程式碼審查流程。它能無縫地與 **Git 儲存庫** (審查提交) 和**本地資料夾** (審查檔案) 協同工作，並利用 Google Gemini 的功能為您的程式碼提供富有洞察力的回饋。

## 功能

*   **互動式介面**：使用者友善的選單式介面將引導您完成整個審查過程。
*   **雙審查模式**：選擇最符合您需求的模式：
    *   **Git 模式**：基於 Git 歷史紀錄分析程式碼變更，非常適合審查功能分支或個別提交。
        *   *範圍提交審查 (累積差異)*：審查指定範圍內所有提交的全部變更。
        *   *個別提交審查*：針對多個選定的個別提交獲取獨立的 AI 回饋，並合併於一份報告中。
    *   **資料夾模式**：直接審查您本地檔案系統中的檔案和資料夾，適用於未受版本控制的專案，或對尚未提交的程式碼獲取回饋。
        *   *階層式選單*：提供一個互動式的檔案瀏覽器，讓您可以在專案中導航、選擇多個檔案或加入整個資料夾進行審查。
*   **AI 驅動的回饋**：利用 Google Gemini 分析程式碼並提供建議、識別潛在的錯誤，並突出顯示風格違規。
*   **可配置與可自訂**：
    *   輕鬆選擇用於審查的 Gemini 模型。
    *   透過修改 `prompts/` 目錄中簡單的 Markdown 檔案，來自訂 AI 的審查指令。
*   **有組織的輸出**：將審查報告儲存為 Markdown 檔案，位於專用的 `results/` 目錄中，檔案名稱清晰，包含時間戳記。
*   **效率與控制**：
    *   *空差異檢查*：自動跳過沒有實際程式碼變更的提交，以節省時間和 API 成本。
    *   *除錯模式*：提供 `--debug` 選項，讓您可以看到發送給 AI 的確切數據而無需實際呼叫 API，這對於開發和提示工程非常有用。

## 前置準備

在開始之前，請確保您的系統上已安裝以下軟體：

*   **Python**：版本 3.9 或更高。([下載 Python](https://www.python.org/downloads/))
*   **uv**：一個快速的 Python 套件安裝器和解析器。([安裝 uv](https://astral.sh/uv/install.sh))
*   **Git**：若要使用 Git 模式則必須安裝。([下載 Git](https://git-scm.com/downloads))

## 設定與安裝

請按照以下步驟設定並運行 AI 程式碼審查 CLI：

1.  **複製儲存庫** (如果您尚未複製)：
    ```bash
    git clone <repository_url>
    cd AICodeReviewCLI
    ```
    *(將 `<repository_url>` 替換為此儲存庫的實際 URL。)*

2.  **導航到專案目錄**：
    ```bash
    cd /path/to/AICodeReviewCLI
    ```
    *(將 `/path/to/AICodeReviewCLI` 替換為您複製儲存庫的實際路徑。)*

3.  **建立並啟用虛擬環境**：
    ```bash
    uv venv
    source .venv/bin/activate
    ```
    *(您應該會在終端機提示符號中看到 `(.venv)` 出現，表示虛擬環境已啟用。)*

4.  **安裝依賴項**：
    ```bash
    uv pip install -e .
    ```

## 配置

### `.env` 檔案 (API 金鑰與模型選擇)

此工具在專案根目錄 (`AICodeReviewCLI/.env`) 使用 `.env` 檔案來管理您的 Google Gemini API 金鑰和偏好的 AI 模型。首次運行工具時，它將引導您完成設定過程：

*   **Gemini API 金鑰 (`GEMINI_API_KEY`)**：
    *   如果未找到或無效，工具將提示您輸入 API 金鑰。
    *   您的金鑰將安全地儲存在 `.env` 檔案中。
    *   您可以從 [Google AI Studio](https://aistudio.google.com/app/apikey) 獲取 Gemini API 金鑰。
*   **Gemini 模型 (`GEMINI_MODEL`)**：
    *   如果未配置，工具將提供一個可用的 Gemini 模型列表供您選擇。
    *   或者，您可以手動輸入模型名稱 (例如，`gemini-1.5-pro-latest`)。
    *   您選擇的模型將儲存在 `.env` 檔案中。

### 自訂提示 (`prompts/` 目錄)

您可以透過修改或新增 `AICodeReviewCLI/prompts/` 目錄中的 Markdown 檔案 (`.md`) 來客製化給 AI 模型的指令。

*   此工具會讀取此目錄中**所有** `.md` 檔案的內容，並將其串聯起來形成完整的 AI 提示。
*   這允許您模組化您的審查指令 (例如，一個檔案用於一般風格，另一個用於安全考量)。

## 使用方式

設定完成後，從專案根目錄運行工具：

```bash
python -m codereview_tool.cli [--debug] [--config|--setup]
```

*   **`--debug`**：(可選) 啟用除錯模式。啟用時，工具將列印程式碼差異和將發送給 AI 的提示，但會跳過實際的 AI API 呼叫。這對於除錯和理解 AI 輸入而無需產生 API 成本非常有用。
*   **`--config` / `--setup`**：(可選) 進入配置模式，重新配置您的 Gemini API 金鑰、模型或預設專案路徑。

工具將引導您完成以下互動步驟：

1.  **專案路徑**：輸入您要審查的專案的絕對路徑。
2.  **審查模式**：選擇您要如何執行審查：
    *   **Git 模式**：審查 Git 儲存庫中的提交。
    *   **資料夾模式**：審查本地的檔案/資料夾。

3.  **後續步驟**：根據您選擇的模式，工具將引導您完成進一步的選擇：
    *   若在 **Git 模式**下，您將選擇一個分支，然後選擇審查一個提交範圍或多個個別提交。
    *   若在 **資料夾模式**下，您將使用一個互動式瀏覽器來選擇您希望 AI 分析的特定檔案和資料夾。

