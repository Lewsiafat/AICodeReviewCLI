# AI 程式碼審查 CLI

這是一個強大的命令列介面 (CLI) 工具，旨在利用人工智慧自動化並增強您的程式碼審查流程。它與 Git 儲存庫無縫整合，並利用 Google Gemini 的功能為您的程式碼變更提供富有洞察力的回饋。

## 功能

*   **互動式介面**：使用者友善的選單式介面引導您完成審查過程。
*   **Git 整合**：自動偵測 Git 儲存庫，擷取分支，並列出最近的提交以方便選擇。
*   **靈活的審查模式**：
    *   **範圍提交審查 (累積差異)**：審查指定範圍內所有提交的變更 (例如，一個功能分支)。
    *   **個別提交審查**：針對多個選定的個別提交獲取獨立的 AI 回饋，並將其合併到一份綜合報告中。
*   **AI 驅動的回饋**：利用 Google Gemini 分析程式碼差異並提供建議，識別潛在的錯誤，並突出顯示風格違規。
*   **可配置的 AI 模型**：輕鬆選擇和管理用於審查的 Gemini 模型。
*   **可自訂的提示**：透過修改簡單的 Markdown 檔案來自訂 AI 的審查指令。
*   **有組織的輸出**：將審查報告儲存為 Markdown 檔案，位於專用 `results/` 目錄中，檔案名稱清晰，包含時間戳記和模型名稱。
*   **空差異檢查**：在個別提交審查期間，自動偵測並跳過沒有實際程式碼變更的提交，避免不必要的 AI API 呼叫。
*   **除錯模式**：提供 `--debug` 選項，透過列印差異和提示來模擬 AI 審查，而無需進行實際的 API 呼叫，這對於開發和成本管理很有用。

## 前置準備

在開始之前，請確保您的系統上已安裝以下軟體：

*   **Git**：版本控制系統。([下載 Git](https://git-scm.com/downloads))
*   **Python**：版本 3.9 或更高。([下載 Python](https://www.python.org/downloads/))
*   **uv**：一個快速的 Python 套件安裝器和解析器。([安裝 uv](https://astral.sh/uv/install.sh))

## 設定與安裝

請按照以下步驟設定並運行 AI 程式碼審查 CLI：

1.  **複製儲存庫** (如果您尚未複製)：
    ```bash
    git clone <repository_url>
    cd AICodeReviewCLI
    ```
    *(將 `<repository_url>` 替換為此儲存庫的實際 URL。)*

2.  **導航到專案目錄**：
    ```bash
    cd /path/to/AICodeReviewCLI
    ```
    *(將 `/path/to/AICodeReviewCLI` 替換為您複製儲存庫的實際路徑。)*

3.  **建立並啟用虛擬環境**：
    ```bash
    uv venv
    source .venv/bin/activate
    ```
    *(您應該會在終端機提示符號中看到 `(.venv)` 出現，表示虛擬環境已啟用。)*

4.  **安裝依賴項**：
    ```bash
    uv pip install -e .
    ```

## 配置

### `.env` 檔案 (API 金鑰與模型選擇)

此工具在專案根目錄 (`AICodeReviewCLI/.env`) 使用 `.env` 檔案來管理您的 Google Gemini API 金鑰和偏好的 AI 模型。首次運行工具時，它將引導您完成設定過程：

*   **Gemini API 金鑰 (`GEMINI_API_KEY`)**：
    *   如果未找到或無效，工具將提示您輸入 API 金鑰。
    *   您的金鑰將安全地儲存在 `.env` 檔案中。
    *   您可以從 [Google AI Studio](https://aistudio.google.com/app/apikey) 獲取 Gemini API 金鑰。
*   **Gemini 模型 (`GEMINI_MODEL`)**：
    *   如果未配置，工具將提供一個可用的 Gemini 模型列表供您選擇。
    *   或者，您可以手動輸入模型名稱 (例如，`gemini-1.5-pro-latest`)。
    *   您選擇的模型將儲存在 `.env` 檔案中。

### 自訂提示 (`prompts/` 目錄)

您可以透過修改或新增 `AICodeReviewCLI/prompts/` 目錄中的 Markdown 檔案 (`.md`) 來客製化給 AI 模型的指令。

*   此工具會讀取此目錄中**所有** `.md` 檔案的內容，並將其串聯起來形成完整的 AI 提示。
*   這允許您模組化您的審查指令 (例如，一個檔案用於一般風格，另一個用於安全考量)。

## 使用方式

設定完成後，從專案根目錄運行工具：

```bash
python -m codereview_tool.cli [--debug]
```

*   **`--debug`**：(可選) 啟用除錯模式。啟用時，工具將列印程式碼差異和將發送給 AI 的提示，但會跳過實際的 AI API 呼叫。這對於除錯和理解 AI 輸入而無需產生 API 成本非常有用。

工具將引導您完成以下互動步驟：

1.  **專案路徑**：輸入您要審查的 Git 儲存庫的絕對路徑。
2.  **分支選擇**：從可用分支列表中選擇您要審查的分支。
3.  **審查模式**：選擇您要如何審查提交：
    *   **範圍提交審查 (累積差異)**：您將從最近的提交列表中選擇一個起始提交和一個結束提交。AI 將審查這兩個點之間的所有變更。
    *   **個別提交審查**：您將從列表中選擇多個特定的提交。AI 將單獨審查每個選定的提交，所有審查結果將合併到一份報告中。
4.  **提交選擇**：根據審查模式，您將從包含其簡短 Hash 和提交訊息的列表中選擇一個範圍或個別提交。

## 輸出

AI 審查完成後，報告將儲存為 Markdown 檔案，位於 `AICodeReviewCLI/results/` 目錄中。

*   **檔案名稱格式**：`YYYYMMDD_HHMMSS_model-name_serial.md`
    *   範例：`20250814_143000_gemini-1.0-pro_001.md`

